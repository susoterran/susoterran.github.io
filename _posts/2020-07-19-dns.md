---
title:  "[PowerDNS] DNS 이론 정리"
excerpt: "네트워크에서 도메인이나 호스트 이름을 숫자로 된 IP 주소로 해석해주는 TCP/IP 네트워크 서비스"
header:
  overlay_color: "#333"
  actions:
--label: "PowerDNS 공식사이트"
--url: "https://www.powerdns.com/"
categories:
  - other
tags:
  - DNS
  - PowerDNS
last_modified_at: 2020-07-19
toc: true
toc_label: "목차"
toc_sticky: true
classes: wide
share: false
layout: single
comments: true
---
## DNS란

- Domain Name System
- 네트워크에서 도메인이나 호스트 이름을 숫자로 된 IP 주소로 해석해주는 TCP/IP 네트워크 서비스
    - 도메인 이름 -> IP 주소 (정방향 조회)
    - IP 주소 -> 도메인 이름 (역방향 조회)
- 계층 구조를 가지는 분산 데이터베이스 형태를 가진다
- 도메인 네임 스페이스 : 각 조직을 구분해주는 도메인 이름을 관리하는 DNS 서버들이 모여서 만들어낸 가상 이름 공간 


## 도메인 네임 스페이스

### 도메인 주소 형식 (IPv4 기준)

- 주소의 영역을 . 으로 구분 -> 라벨(Label)
    - 하나의 라벨은 최대 63개의 문자 (64byte) 사용 가능
    - 대소문자 구분 없이 알파벳, -만 가능 (ASCII로 표현)
    - 전체 도메인 주소의 최대 크기 : 255개의 문자 (255byte)
- 주소 해석은 오른쪽에서 부터. 최상위 주소는 항상 가장 오른쪽에 있는 .(root)

<center><img src="https://github.com/susoterran/susoterran.github.io/blob/master/assets/img/dns/domain-address.jpg?raw=true"></center>

### 도메인 주소 구조

- 루트 도메인 (Root Domain)
    - 네임 스페이스에서 이름 해석의 출발지 역할을 수행하는 서버
    - 최상위 도메인 서버의 정보를 가지고 있다.
    - 전 세계에 13개의 원본 root 서버가 존재 (http://www.iana.org/domains/root/servers)
    - 우리나라는 KISA에서 4대의 미러 서버를 운영하고 있다.

- 최상위 도메인 (Top Level Domain = TLD)
    - 국가 코드 최상이 도메인 (ccTLD : country code TLD)
        - .kr, .jp 등
    - 일반 최상위 도메인 (gTLD = global TLD)
        - .net, .com, org 등
    - ARPA : 역방향 도메인을 해석할 때 사용되는 최상위 도메인
        - in-addr.arpa
- 2차 도메인 (Second Level Domain, Sub Domain)
    - TLD 하위에서 관리되는 서브 도메인
    - 국가 도메인 하위에 기관 유형에 따른 분류
        - .co (일반회사), .ac (교육기관), .go (정부기관) 등
- 서브 도메인 (Sub Domain)
    - 상위 도메인에 소속되는 각 기관 또는 회사별 도메인
        - ex : google, naver 등
- 하위 노드는 무한정 만들 수 있지만 주소를 이룰 수 있는 문자 수에 제한이 있다 (255byte)

### DNS 레코드

- DNS의 정보 단위이며, 실제 주소 해석에 사용되는 정보

| 코드 | 이름 | 의미 |
|:---:|:---|:---|
|1|A (Adress) | 요청된 name의 IPv4 주소|
|28|AAAA | 요청된 name의 IPv6 주소|
|2|NS (Name Server) | 요청된 name의 이름 해석을 담당하는 네임 서버의 도메인 주소|
|5|CNAME (Canonical Name) | 시스템에 지정된 공식 도메인 주소에 대한 별칭 도메인 주소|
|6|SOA (Start of Authrity) | DNS 영역의 시작을 알림. Zone에 대한 동기화 설정|
|12|PTR (Pointer) | 요청된 IP 주소의 도메인 주소|
|15|MX (Mail eXchanger) | 메일서버 별칭에 대한 실제 도메인 주소|


## DNS 동작 방식

<center><img src="https://github.com/susoterran/susoterran.github.io/blob/master/assets/img/dns/domain-query.jpg?raw=true"></center>


<p style="font-size: 0.7em">
&nbsp;&nbsp;&nbsp;&nbsp;1번 : 사용자가 www.naver.com 에 대해 DNS 조회를 진행
</p><p style="font-size: 0.7em">
&nbsp;&nbsp;&nbsp;&nbsp;2번 : Cache 네임 서버에 www.naver.com에 대한 값이 있다면 8번으로 진행. 없다면 루트 네임 서버에 www.naver.com에 대한 답을 요청
</p><p style="font-size: 0.7em">
&nbsp;&nbsp;&nbsp;&nbsp;3번 : 루트 네임 서버는 com 네임 서버의 IP 주소를 Cache 네임 서버에 전달
</p><p style="font-size: 0.7em">
&nbsp;&nbsp;&nbsp;&nbsp;4번 : Cache 네임 서버는 com 네임 서버에 www.naver.com에 대한 답을 요청
</p><p style="font-size: 0.7em">
&nbsp;&nbsp;&nbsp;&nbsp;5번 : com 네임 서버는 네이버 네임 서버의 IP 주소를 Cache 네임 서버에 전달
</p><p style="font-size: 0.7em">
&nbsp;&nbsp;&nbsp;&nbsp;6번 : Cache 네임 서버는 네이버 네임 서버에 www.naver.com에 대한 답을 요청
</p><p style="font-size: 0.7em">
&nbsp;&nbsp;&nbsp;&nbsp;7번 : 네이버 네임 서버는 www.naver.com의 IP 주소를 Cache 네임 서버에 전달
</p><p style="font-size: 0.7em">
&nbsp;&nbsp;&nbsp;&nbsp;8번 : Cache 네임 서버는 www.naver.com의 IP 주소를 사용자에게 전달
</p>
- 1, 8번과 같이 사용자와 Cache 네임 서버 사이의 요청/응답 과정을 'Recursive Query' 라고 한다.
- 2 ~ 6번과 같이 Cache 네임 서버와 각 계층의 네임 서버 사이의 요청/응답 과정을 'Iterative Query' 라고 한다.
- 만약 Cache 네임 서버가 사용자가 조회한 값을 가지고 있다면 Iterative Query 과정 없이 사용자에게 값을 전달한다. 이를 '권한 있는 응답'이라고 한다.
- Cache 네임 서버에 조회 값이 없어 Iterative Query 과정을 통해 사용자에게 값을 전달하는 것을 '권한 없는 응답'이라고 한다.